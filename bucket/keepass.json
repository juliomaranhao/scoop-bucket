{
    "version": "2.58",
    "description": "Light-weight and easy-to-use password manager",
    "homepage": "https://keepass.info",
    "license": "GPL-2.0-or-later",
    "url": "https://downloads.sourceforge.net/project/keepass/KeePass%202.x/2.58/KeePass-2.58.zip",
    "hash": "sha1:5ed611196f0a97c176f7aa3c145d4d64b766749b",
    "pre_install": [
        "function Set-Node-to-False {",
        "    param (",
        "        $config",
        "        $nodepath",
        "    )",
        "    $node = $config.SelectSingleNode($nodepath)",
        "    if (($node -eq $null) -or ($node.InnerText -ne \"false\")) {",
        "        if ($node) {",
        "            $node.InnerText = \"false\"",
        "        } else {",
        "            $parts = $nodepath -split \"/\"",
        "            $branch = \"/\"+(($parts[0..($parts.Length-2)]) -join \"/\")",
        "            $leaf = $parts[-1]",
        "            $branchnode = $config.SelectSingleNode($branch)",
        "            $leafnode = $config.CreateElement($leaf)",
        "            $leafnode.InnerText = \"false\"",
        "            $branchnode.AppendChild($leafnode) | Out-Null",
        "        }",
        "        return $True",
        "    }",
        "    return $False",
        "}",
        "function Disable-KeePassTransactions {",
        "    param (",
        "        $FileName",
        "    )",
        "    $config = New-Object System.Xml.XmlDocument",
        "    $config.Load($FileName)",
        "    $changed = Set-Node-to-False $config \"/Configuration/Application/UseTransactedFileWrites\"",
        "    $changed = $changed -or (Set-Node-to-False $config \"/Configuration/Application/UseTransactedConfigWrites\")",
        "    if ($changed) {",
        "        $settings = New-Object System.Xml.XmlWriterSettings",
        "        $settings.Indent = $true",
        "        $settings.IndentChars = \"`t\"",
        "        $settings.Encoding = New-Object System.Text.UTF8Encoding($false)",
        "        $writer = [System.Xml.XmlWriter]::Create($FileName, $settings)",
        "        $config.Save($writer)",
        "        $writer.Dispose()",
        "    }",
        "}",
        "if (Test-Path \"$persist_dir\\KeePass.config.xml\") {",
        "    Disable-KeePassTransactions \"$persist_dir\\KeePass.config.xml\"",
        "} else {",
        "    $content = \"<?xml version=`\"1.0`\" encoding=`\"utf-8`\"?>",
        "<Configuration xmlns:xsd=`\"http://www.w3.org/2001/XMLSchema`\" xmlns:xsi=`\"http://www.w3.org/2001/XMLSchema-instance`\">",
        "    <Application>",
        "        <UseTransactedFileWrites>false</UseTransactedFileWrites>",
        "        <UseTransactedConfigWrites>false</UseTransactedConfigWrites>",
        "    </Application>",
        "</Configuration>\"",
        "    Out-File -InputObject $content -FilePath \"$dir\\KeePass.config.xml\" -Encoding ascii",
        "}"
    ],
    "bin": "KeePass.exe",
    "shortcuts": [
        [
            "KeePass.exe",
            "KeePass"
        ]
    ],
    "persist": [
        "KeePass.config.xml",
        "Plugins",
        "Languages"
    ],
    "checkver": {
        "url": "https://keepass.info/update/version2x.txt",
        "regex": "KeePass:([\\d.]+)"
    },
    "autoupdate": {
        "url": "https://downloads.sourceforge.net/project/keepass/KeePass%20$majorVersion.x/$version/KeePass-$version.zip"
    }
}
